:root {
    --haven-green: #2a3431;
    --primary-purple: #6366f1;
    --danger-red: #f43f5e;
    --bg-primary: #121212;
    --bg-secondary: #1E1E1E;
    --text-primary: #EAEAEA;
    --text-secondary: #888888;
    --border-color: #2C2C2C;
    --bubble-sent-bg: #005c4b;
    --bubble-sent-text: #EAEAEA;
    --bubble-received-bg: #202c33;
    --bubble-received-text: #EAEAEA;
    --font-family: 'Work Sans', sans-serif;
}
html.light {
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --text-primary: #111827;
    --text-secondary: #6b7280;
    --border-color: #e5e7eb;
    --bubble-sent-bg: #dcf8c6;
    --bubble-sent-text: #111827;
    --bubble-received-bg: #ffffff;
    --bubble-received-text: #111827;
}

html { height: 100%; }
body {
    height: 100vh;
    /* MODIFICATION: The JS will set --vh, this is a fallback */
    height: calc(var(--vh, 1vh) * 100);
    margin: 0;
    font-family: var(--font-family);
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    display: flex; justify-content: center; align-items: center;
    box-sizing: border-box;
    transition: background-color 0.5s ease;
    overflow: hidden;
}

.chat-container { width: 100%; height: 100%; background-color: var(--bg-primary); border-radius: 24px; border: 1px solid var(--border-color); box-sizing: border-box; display: flex; flex-direction: column; overflow: hidden; transition: all 0.5s ease; }
.chat-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 32px; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
.peer-status-bar { display: flex; align-items: center; gap: 12px; padding: 8px 20px; border-radius: 12px; background-color: var(--bg-secondary); border: 1px solid var(--border-color); transition: all 0.5s ease; }
.peer-soultag { font-weight: 600; color: var(--text-primary); }
.peer-activity { color: var(--text-secondary); }
.header-actions { display: flex; align-items: center; gap: 24px; }
.exit-button { background-color: var(--danger-red); color: white; border: none; border-radius: 12px; padding: 10px 20px; font-size: 1rem; font-weight: 600; font-family: var(--font-family); cursor: pointer; transition: opacity 0.2s ease; }
.exit-button:hover { opacity: 0.85; }
.theme-switcher { width: 48px; height: 48px; border-radius: 50%; border: 1px solid var(--border-color); background-color: var(--bg-primary); cursor: pointer; padding: 0; position: relative; overflow: hidden; transition: all 0.5s ease; }
.sun-wrapper, .moon-wrapper { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1); }
.sun-wrapper { background-color: var(--bg-primary); color: var(--text-primary); transform: translateY(0); }
.moon-wrapper { background-color: var(--text-primary); color: var(--bg-primary); transform: translateY(100%); }
html.dark .sun-wrapper { transform: translateY(-100%); }
html.dark .moon-wrapper { transform: translateY(0); }
.message-area-wrapper { flex-grow: 1; position: relative; display: flex; overflow: hidden; }
.message-area { flex-grow: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 12px; }
.message-bubble { max-width: 60%; padding: 12px 18px; border-radius: 20px; line-height: 1.5; font-size: 1rem; }
.message-bubble p { margin: 0; word-wrap: break-word; }
.received { background-color: var(--bubble-received-bg); color: var(--bubble-received-text); border-bottom-left-radius: 4px; align-self: flex-start; }
.sent { background-color: var(--bubble-sent-bg); color: var(--bubble-sent-text); border-bottom-right-radius: 4px; align-self: flex-end; }
.message-area::-webkit-scrollbar, .emoji-palette::-webkit-scrollbar, .message-input::-webkit-scrollbar { width: 8px; }
.message-area::-webkit-scrollbar-track, .emoji-palette::-webkit-scrollbar-track, .message-input::-webkit-scrollbar-track { background: transparent; }
.message-area::-webkit-scrollbar-thumb, .emoji-palette::-webkit-scrollbar-thumb, .message-input::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
.message-area::-webkit-scrollbar-thumb:hover, .emoji-palette::-webkit-scrollbar-thumb:hover, .message-input::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
.exit-panel { position: absolute; top: 0; right: 0; bottom: 0; width: 350px; background-color: var(--bg-primary); border-left: 1px solid var(--border-color); padding: 24px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; transform: translateX(100%); transition: transform 0.5s cubic-bezier(0.76, 0, 0.24, 1); }
.exit-panel.visible { transform: translateX(0); }
.exit-title { font-size: 1.5rem; font-weight: 600; margin: 0 0 12px 0; color: var(--text-primary); text-align: left; }
.exit-description { font-size: 1rem; color: var(--text-secondary); line-height: 1.6; margin: 0 0 24px 0; text-align: left; }
.exit-actions { display: flex; gap: 12px; }
.exit-panel-button { flex: 1; padding: 10px; font-size: 1rem; font-weight: 600; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; border: 1px solid var(--border-color); }
.exit-panel-button.confirm { background-color: var(--text-primary); color: var(--bg-primary); }
.exit-panel-button:not(.confirm) { background-color: transparent; color: var(--text-primary); }
.exit-panel-button:hover { opacity: 0.8; }
.chat-footer { padding: 16px 24px; border-top: 1px solid var(--border-color); flex-shrink: 0; }
.input-wrapper { position: relative; display: flex; align-items: flex-end; background-color: var(--bg-secondary); border-radius: 24px; padding: 4px; }
.input-wrapper:focus-within { border-color: var(--primary-purple); }
.message-input { width: 100%; border: none; background: transparent; resize: none; padding: 10px 48px 10px 52px; font-size: 1rem; font-family: var(--font-family); color: var(--text-primary); max-height: 120px; line-height: 1.5; }
.message-input:focus { outline: none; }
.icon-button { position: absolute; bottom: 8px; width: 36px; height: 36px; border-radius: 50%; border: none; background: none; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
.icon-button#emoji-button { left: 8px; }
.icon-button#send-button { right: 8px; background-color: var(--primary-purple); color: white; }
.icon-button:hover { opacity: 0.85; }
.emoji-container { position: static; }
.emoji-palette { position: absolute; bottom: calc(100% + 10px); left: 0; width: 380px; max-height: 320px; background-color: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 16px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); padding: 12px; display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 8px; overflow-y: auto; opacity: 0; transform: translateY(10px) scale(0.95); pointer-events: none; transition: opacity 0.2s ease, transform 0.2s ease; transform-origin: bottom left; }
.emoji-palette.visible { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
.emoji-palette button { background: none; border: none; border-radius: 8px; font-size: 28px; cursor: pointer; padding: 4px; }
.emoji-palette button:hover { background-color: var(--bg-secondary); }

/* --- Responsiveness --- */
@media (max-width: 820px) {
    body { padding: 0; }
    .chat-container { height: 100%; border-radius: 0; border: none; }
    .chat-header { padding: 12px 16px; justify-content: space-between; gap: 12px; }
    .peer-status-bar { flex-shrink: 1; min-width: 0; }
    .peer-soultag, .peer-activity { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .header-actions { flex-shrink: 0; gap: 12px; }
    .exit-panel { width: 100%; border-left: none; }
    .chat-footer { padding: 8px; }
}
@media (min-width: 821px) {
    .peer-status-bar { padding: 10px 24px; font-size: 1.1rem; }
    .exit-button { padding: 12px 24px; }
    .message-bubble { font-size: 1.125rem; padding: 14px 22px; }
    .input-wrapper { border-radius: 28px; padding: 6px; }
    .message-input { font-size: 1.125rem; padding: 12px 60px; }
    .icon-button { width: 48px; height: 48px; }
    .icon-button#emoji-button { left: 10px; }
    .icon-button#send-button { right: 10px; }
}